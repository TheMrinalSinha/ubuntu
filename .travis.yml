language: bash
sudo:     true

# before_install:
#   - sudo apt-get install -y sshpass

addons:
  apt:
    update: true

# after_success:
#   - echo "Deploying to server..."
#   - sshpass -p $SERVER_SECRET scp -v -o stricthostkeychecking=no -r * $SERVER_USERNAME@$SERVER_HOSTNAME:/srv/hosted_files/ubuntu/

before_install:
  - 'which ssh-agent || ( apt-get update -y && apt-get install openssh-client -y )'
  - eval $(ssh-agent -s)

after_success:
  - echo "Deploying to server..."
  - echo $PRIVATE_KEY | base64 -d > private_key
  - chmod 600 private_key
  - rsync --delete -avP * --exclude='private_key' -e "ssh -oStrictHostKeyChecking=no -i private_key" $SERVER_USERNAME@$SERVER_HOSTNAME:/srv/hosted_files/ubuntu/
